<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>–õ–µ–Ω—Ç–∞ —Ä–∞–π–æ–Ω–∞</title>
    <style>
        body { font-family: system-ui, -apple-system, Arial; margin: 16px; background: #f5f5f5; }
        h3 { margin-bottom: 8px; }
        .card { background: white; border: 1px solid #ddd; border-radius: 10px; padding: 14px; margin: 12px 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .meta { color: #666; font-size: 12px; margin-bottom: 8px; }
        .text { line-height: 1.5; }
        img { max-width: 100%; border-radius: 8px; margin-top: 10px; display: block; }
        .delete-btn { background: #ff4444; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin-top: 8px; }
    </style>
</head>
<body>
    <h3>üèò –õ–µ–Ω—Ç–∞ —Ä–∞–π–æ–Ω–∞</h3>
    <p style="color: #666; font-size: 14px;">–°–æ–±—Ä–∞–Ω–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ —Ä–∞–π–æ–Ω–∞.</p>
    <div id="list"></div>

    <script>
        const adminUsername = prompt('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à username (–µ—Å–ª–∏ –≤—ã –∞–¥–º–∏–Ω):') || ''
        async function load() {
            try {
                const res = await fetch('/api/news')
                const data = await res.json()
                const el = document.getElementById('list')
                el.innerHTML = ''

                if (!data.posts || data.posts.length === 0) {
                    el.innerHTML = '<div class="card">–ü–æ–∫–∞ –Ω–µ—Ç –Ω–æ–≤–æ—Å—Ç–µ–π.</div>'
                    return
                }

                for (const p of data.posts) {
                    const d = document.createElement('div')
                    d.className = 'card'
                    d.innerHTML = `
                        <div class="meta">#\${p.id} ‚Ä¢ \${new Date(p.createdAt).toLocaleString('ru-RU')} ‚Ä¢ \${p.source}</div>
                        <div class="text">\${escapeHtml(p.text || '')}</div>
                        \${p.photoFileId ? `<img src="/api/photo/\${p.photoFileId}" alt="–§–æ—Ç–æ">` : ''}
                        <button class="delete-btn" data-id="\${p.id}" style="display:none;">‚ùå –£–¥–∞–ª–∏—Ç—å</button>`
                    el.appendChild(d)

                    const deleteBtn = d.querySelector('.delete-btn')
                    if (adminUsername.toLowerCase() === 'fusuges') {
                        deleteBtn.style.display = 'block'
                        deleteBtn.onclick = async () => {
                            if (!confirm(`–£–¥–∞–ª–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å #\${p.id}?`)) return
                            try {
                                const res = await fetch(`/api/news/\${p.id}?admin=\${adminUsername}`, { method: 'DELETE' })
                                if (res.ok) {
                                    d.remove()
                                    alert('–ù–æ–≤–æ—Å—Ç—å —É–¥–∞–ª–µ–Ω–∞')
                                } else {
                                    alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è')
                                }
                            } catch (err) {
                                alert('–û—à–∏–±–∫–∞: ' + err.message)
                            }
                        }
                    }
                }
            } catch (err) {
                document.getElementById('list').innerHTML = '<div class="card">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + err.message + '</div>'
            }
        }
        function escapeHtml(s){
            return (s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]))
        }
        load()
    </script>
</body>
</html>
