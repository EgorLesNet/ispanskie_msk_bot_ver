# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç –Ω–æ–≤–æ—Å—Ç–µ–π –≤—Å–µ–º –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤ 21:00 –ø–æ –º–æ—Å–∫–æ–≤—Å–∫–æ–º—É –≤—Ä–µ–º–µ–Ω–∏.

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

- `users.json` - —Ö—Ä–∞–Ω–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∏—Ö –ø–æ–¥–ø–∏—Å–∫–∏
- `dailyDigest.json` - —Ö—Ä–∞–Ω–∏—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–π–¥–∂–µ—Å—Ç—ã (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π)

### 2. Backend (Node.js)

- `lib/digest.js` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤ —á–µ—Ä–µ–∑ Groq API (llama-3.3-70b-versatile)
- `lib/users.js` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏
- `api/digest.js` - API endpoint –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–π–¥–∂–µ—Å—Ç–∞–º–∏
- `api/send-digest.js` - API endpoint –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤

### 3. Telegram –±–æ—Ç (Webhook)

- `api/telegram.js` - Telegram –±–æ—Ç –Ω–∞ Vercel —Å –∫–æ–º–∞–Ω–¥–∞–º–∏:
  - `/start` - –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å –∫–Ω–æ–ø–∫–æ–π "–í–∫–ª—é—á–∏—Ç—å –¥–∞–π–¥–∂–µ—Å—Ç"
  - `/digest_on` - –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –¥–∞–π–¥–∂–µ—Å—Ç
  - `/digest_off` - –æ—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç –¥–∞–π–¥–∂–µ—Å—Ç–∞
  - `/digest_status` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏

### 4. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

- `.github/workflows/send-daily-digest.yml` - GitHub Actions –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ Vercel Environment Variables:

```env
BOT_TOKEN=your_telegram_bot_token
GROQ_API_KEY=your_groq_api_key  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
WEBAPP_URL=https://your-domain.vercel.app
CRON_SECRET=random_secret_key_123  # –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Å–ª—É—á–∞–π–Ω—É—é —Å—Ç—Ä–æ–∫—É
```

### 2. GitHub Secrets

–î–æ–±–∞–≤—å—Ç–µ –≤ Settings > Secrets and variables > Actions:

- `API_URL` - –≤–∞—à URL Vercel (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://ispanskie-msk-bot-ver.vercel.app`)
- `CRON_SECRET` - —Ç–æ—Ç –∂–µ —Å–µ–∫—Ä–µ—Ç, —á—Ç–æ –∏ –≤ Vercel

### 3. –ê–∫—Ç–∏–≤–∞—Ü–∏—è GitHub Actions

GitHub Actions —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –±—É–¥–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 21:00 MSK.

–î–ª—è —Ç–µ—Å—Ç–æ–≤–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏:
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Actions > Send Daily Digest
2. –ù–∞–∂–º–∏—Ç–µ "Run workflow"
3. –í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ç–∫—É `main`
4. –ù–∞–∂–º–∏—Ç–µ "Run workflow"

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü–æ–¥–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/start` –≤ –±–æ—Ç–µ
2. –ü–æ—è–≤–ª—è–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "üì∞ –í–∫–ª—é—á–∏—Ç—å –¥–∞–π–¥–∂–µ—Å—Ç"
3. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `users.json`

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–π–¥–∂–µ—Å—Ç–∞

1. **–°–±–æ—Ä –Ω–æ–≤–æ—Å—Ç–µ–π** - –±–µ—Ä—É—Ç—Å—è –≤—Å–µ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è –∏–∑ `db.json`
2. **–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Groq** - –Ω–æ–≤–æ—Å—Ç–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ llama-3.3-70b —Å –ø—Ä–æ–º–ø—Ç–æ–º
3. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `dailyDigest.json` (–Ω–∞ –≤–µ—Å—å –¥–µ–Ω—å)
4. **Fallback** - –µ—Å–ª–∏ Groq API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –¥–∞–π–¥–∂–µ—Å—Ç

### –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ 21:00

1. **GitHub Actions** –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (cron: `0 18 * * *`)
2. –î–µ–ª–∞–µ—Ç POST –∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/send-digest`
3. API –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–π–¥–∂–µ—Å—Ç –∏ —Å–ø–∏—Å–æ–∫ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–∞–∂–¥–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π "üì± –û—Ç–∫—Ä—ã—Ç—å –•–ê–ë"
5. –õ–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

## API Endpoints

### GET /api/digest
–ü–æ–ª—É—á–∏—Ç—å –¥–∞–π–¥–∂–µ—Å—Ç –∑–∞ —Å–µ–≥–æ–¥–Ω—è (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ)

### GET /api/digest?date=2026-02-03
–ü–æ–ª—É—á–∏—Ç—å –¥–∞–π–¥–∂–µ—Å—Ç –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É

### POST /api/send-digest
–û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–π–¥–∂–µ—Å—Ç –≤—Å–µ–º –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º

**Headers:**
```
Authorization: Bearer YOUR_CRON_SECRET
```

**Response:**
```json
{
  "success": true,
  "postsCount": 8,
  "subscribersCount": 15,
  "sentCount": 15,
  "errorCount": 0,
  "timestamp": "2026-02-03T18:00:00.000Z"
}
```

## –ü—Ä–∏–º–µ—Ä –¥–∞–π–¥–∂–µ—Å—Ç–∞

```
üì∞ –î–∞–π–¥–∂–µ—Å—Ç –¥–Ω—è

–°–µ–≥–æ–¥–Ω—è –≤ –ò—Å–ø–∞–Ω—Å–∫–∏—Ö –ö–≤–∞—Ä—Ç–∞–ª–∞—Ö:

ü•∂ –ù–∞ –ú–∞–≥–µ–ª–ª–∞–Ω–∞ 2 –ø—Ä–æ–±–ª–µ–º—ã —Å –æ—Ç–æ–ø–ª–µ–Ω–∏–µ–º –Ω–∞ –ª–µ—Å—Ç–Ω–∏—Ü–∞—Ö - –£–ö 
–≥–æ–≤–æ—Ä–∏—Ç "–≤—Å—ë —Ö–æ—Ä–æ—à–æ", –Ω–æ –±–∞—Ç–∞—Ä–µ–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

üè¶ –°–±–µ—Ä–±–∞–Ω–∫ –Ω–∞ –≤—Ä–µ–º—è –∑–∞–∫—Ä—ã—Ç (–¥–æ 22 –∞–ø—Ä–µ–ª—è)

üöß –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –º–∞—Å—à—Ç–∞–±–Ω–∞—è —Ä–µ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–æ—Ä–æ–≥ –≤ —Ä–∞–π–æ–Ω–µ –°–ë–í - 
–ø–æ—è–≤—è—Ç—Å—è –Ω–æ–≤—ã–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —É –ø–∞—Ä–∫–∏–Ω–≥–∞

‚ùÑÔ∏è –ê–∫—Ç–∏–≤–Ω–æ —á–∏—Å—Ç—è—Ç —Å–Ω–µ–≥, –¥–≤–æ—Ä–Ω–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç

–í—Å–µ–≥–æ –Ω–æ–≤–æ—Å—Ç–µ–π: 8

[üì± –û—Ç–∫—Ä—ã—Ç—å –•–ê–ë] <- –∫–Ω–æ–ø–∫–∞
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### GitHub Actions –ª–æ–≥–∏
–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤: Actions > Send Daily Digest > –ø–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—É—Å–∫

### Vercel –ª–æ–≥–∏
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Vercel Dashboard > –≤–∞—à –ø—Ä–æ–µ–∫—Ç > Logs
- –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –∫ `/api/send-digest`

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `dailyDigest.json` - –∏—Å—Ç–æ—Ä–∏—è –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π)
- `users.json` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤

## Troubleshooting

### –î–∞–π–¥–∂–µ—Å—Ç—ã –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ GitHub Actions:**
   - Actions > Send Daily Digest
   - –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Secrets:**
   - Settings > Secrets > Actions
   - `API_URL` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º
   - `CRON_SECRET` –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å Vercel

3. **–¢–µ—Å—Ç–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞:**
   ```bash
   curl -X POST \
     -H "Authorization: Bearer YOUR_CRON_SECRET" \
     https://your-domain.vercel.app/api/send-digest
   ```

### –ö–Ω–æ–ø–∫–∞ –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ /start

1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: `/start`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é `api/telegram.js` –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Vercel –ø–µ—Ä–µ—Ä–∞–∑–≤–µ—Ä–Ω—É–ª—Å—è

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Vercel –ª–æ–≥–∏ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `lib/users.js` –ø–æ–¥–∫–ª—é—á—ë–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ `users.json`

### –û—à–∏–±–∫–∞ Groq API

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å API –∫–ª—é—á–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–∏–º–∏—Ç—ã –Ω–∞ https://console.groq.com
3. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ fallback –Ω–∞ –ø—Ä–æ—Å—Ç–æ–π –¥–∞–π–¥–∂–µ—Å—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ

## –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

–î–ª—è —Ç–µ—Å—Ç–æ–≤–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–π–¥–∂–µ—Å—Ç–∞:

```bash
curl -X POST \
  -H "Authorization: Bearer YOUR_CRON_SECRET" \
  https://your-domain.vercel.app/api/send-digest
```

–ò–ª–∏ —á–µ—Ä–µ–∑ GitHub Actions:
1. Actions > Send Daily Digest
2. Run workflow > –≤—ã–±–µ—Ä–∏—Ç–µ `main`
3. Run workflow
