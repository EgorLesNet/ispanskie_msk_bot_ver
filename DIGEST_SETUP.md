# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç –Ω–æ–≤–æ—Å—Ç–µ–π –≤—Å–µ–º –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤ 21:00 –ø–æ –º–æ—Å–∫–æ–≤—Å–∫–æ–º—É –≤—Ä–µ–º–µ–Ω–∏.

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

- `users.json` - —Ö—Ä–∞–Ω–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∏—Ö –ø–æ–¥–ø–∏—Å–∫–∏
- `dailyDigest.json` - —Ö—Ä–∞–Ω–∏—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–π–¥–∂–µ—Å—Ç—ã (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π)

### 2. Backend (Node.js)

- `lib/digest.js` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤ —á–µ—Ä–µ–∑ Groq API (llama-3.3-70b-versatile)
- `lib/users.js` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏
- `api/digest.js` - API endpoint –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–π–¥–∂–µ—Å—Ç–∞–º–∏

### 3. Telegram –±–æ—Ç (Python)

- `bot_digest.py` - –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç —Å –∫–æ–º–∞–Ω–¥–∞–º–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–æ–π
- `send_digest.py` - —Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é

## –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- `/start` - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å –∫–Ω–æ–ø–∫–∞–º–∏
- `/digest_on` - –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –¥–∞–π–¥–∂–µ—Å—Ç
- `/digest_off` - –û—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç –¥–∞–π–¥–∂–µ—Å—Ç–∞
- `/digest_status` - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏
- `/help` - –°–ø—Ä–∞–≤–∫–∞

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:

```env
TELEGRAM_BOT_TOKEN=your_bot_token_here
GROQ_API_KEY=your_groq_api_key_here  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
API_URL=https://your-domain.vercel.app/api/digest
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

#### Python:
```bash
pip install python-telegram-bot
```

#### Node.js:
```bash
npm install
```

### 3. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
python3 bot_digest.py
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ cron –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –õ–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä

```bash
crontab -e
```

–î–æ–±–∞–≤—å—Ç–µ:
```
0 21 * * * cd /path/to/ispanskie_msk_bot_ver && /usr/bin/python3 send_digest.py >> /var/log/digest.log 2>&1
```

#### –í–∞—Ä–∏–∞–Ω—Ç 2: Vercel Cron Jobs

–î–æ–±–∞–≤—å—Ç–µ –≤ `vercel.json`:

```json
{
  "crons": [{
    "path": "/api/cron/send-digest",
    "schedule": "0 18 * * *"
  }]
}
```

–°–æ–∑–¥–∞–π—Ç–µ `api/cron/send-digest.js`:

```javascript
const { getTodayDigest } = require('../../lib/digest');
const { getDigestSubscribers } = require('../../lib/users');

module.exports = async (req, res) => {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
  if (req.headers['authorization'] !== `Bearer ${process.env.CRON_SECRET}`) {
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  try {
    const digest = await getTodayDigest(process.env.GROQ_API_KEY);
    const subscribers = await getDigestSubscribers();
    
    // –ó–¥–µ—Å—å –Ω—É–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —á–µ—Ä–µ–∑ Telegram
    // —Ç–∞–∫ –∫–∞–∫ Vercel Serverless Functions –Ω–µ –º–æ–≥—É—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –¥–ª–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
    
    res.json({ success: true, sent: subscribers.length });
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
};
```

#### –í–∞—Ä–∏–∞–Ω—Ç 3: GitHub Actions (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–°–æ–∑–¥–∞–π—Ç–µ `.github/workflows/send-digest.yml`:

```yaml
name: Send Daily Digest

on:
  schedule:
    - cron: '0 18 * * *'  # 21:00 MSK = 18:00 UTC
  workflow_dispatch:  # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é

jobs:
  send-digest:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          pip install python-telegram-bot
      
      - name: Send digest
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          API_URL: ${{ secrets.API_URL }}
        run: |
          python send_digest.py
```

## API Endpoints

### GET /api/digest
–ü–æ–ª—É—á–∏—Ç—å –¥–∞–π–¥–∂–µ—Å—Ç –∑–∞ —Å–µ–≥–æ–¥–Ω—è (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ)

### GET /api/digest?date=2026-02-03
–ü–æ–ª—É—á–∏—Ç—å –¥–∞–π–¥–∂–µ—Å—Ç –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É

### POST /api/digest/subscribe
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–æ–π
```json
{
  "tgId": 123456789,
  "enabled": true
}
```

### GET /api/digest/status?tgId=123456789
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏

## –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤

–î–∞–π–¥–∂–µ—Å—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ **Groq API** —Å –º–æ–¥–µ–ª—å—é **llama-3.3-70b-versatile**.

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Groq:
- ‚ö° **–ë—ã—Å—Ç—Ä–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è** - –æ—Ç–≤–µ—Ç –∑–∞ 1-2 —Å–µ–∫—É–Ω–¥—ã
- üíé **–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier** - —â–µ–¥—Ä—ã–µ –ª–∏–º–∏—Ç—ã
- ü§ñ **–ö–∞—á–µ—Å—Ç–≤–æ** - –º–æ–¥–µ–ª—å Llama 3.3 70B –æ—Ç–ª–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä—É—Å—Å–∫–∏–º —è–∑—ã–∫–æ–º

–ï—Å–ª–∏ API –∫–ª—é—á –Ω–µ —É–∫–∞–∑–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –¥–∞–π–¥–∂–µ—Å—Ç –±–µ–∑ AI.

–î–∞–π–¥–∂–µ—Å—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è **–æ–¥–∏–Ω —Ä–∞–∑ –≤ –¥–µ–Ω—å** –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ –∫ `/api/digest` –∏ –∫–µ—à–∏—Ä—É–µ—Ç—Å—è –≤ `dailyDigest.json`.

### –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–∞ Groq:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://console.groq.com
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∏–ª–∏ –≤–æ–π–¥–∏—Ç–µ
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ API Keys
4. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∫–ª—é—á
5. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env`: `GROQ_API_KEY=gsk_...`

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- –õ–æ–≥–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏: `/var/log/digest.log`
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ `dailyDigest.json`: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤–æ—Å—Ç–µ–π, –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- Telegram –±–æ—Ç –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è cron endpoints
- API –∫–ª—é—á Groq —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `.env`
- Token –±–æ—Ç–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `.env`
- `.gitignore` –∏—Å–∫–ª—é—á–∞–µ—Ç —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã

## Troubleshooting

### –î–∞–π–¥–∂–µ—Å—Ç—ã –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ cron: `crontab -l`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `tail -f /var/log/digest.log`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è

### –î–∞–π–¥–∂–µ—Å—Ç –ø—É—Å—Ç–æ–π
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –µ—Å—Ç—å –ª–∏ –Ω–æ–≤–æ—Å—Ç–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è –≤ `db.json`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤ `dailyDigest.json`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á Groq

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ `users.json`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç: `/digest_status`

### –û—à–∏–±–∫–∞ Groq API
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å API –∫–ª—é—á–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–∏–º–∏—Ç—ã –Ω–∞ https://console.groq.com
3. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ fallback –Ω–∞ –ø—Ä–æ—Å—Ç–æ–π –¥–∞–π–¥–∂–µ—Å—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ
