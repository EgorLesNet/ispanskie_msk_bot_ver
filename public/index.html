<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ê–≥—Ä–µ–≥–∞—Ç–æ—Ä –¥–ª—è —Ä–∞–π–æ–Ω–∞</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  min-height:100vh;
  background:#f0f2f5;
  color:#1a1a1a;
  transition:background 0.3s ease, color 0.3s ease;
  padding-top:80px;
  padding-bottom:90px;
}
body[data-theme="dark"]{
  background:#0e0e0e;
  color:#fff;
}

.header{
  position:fixed;top:12px;left:12px;right:12px;z-index:100;
  display:flex;justify-content:space-between;align-items:center;
  padding:14px 18px;
  border-radius:20px;
}
.logo-img{
  width:40px;height:40px;border-radius:10px;transition:transform 0.3s;cursor:pointer;
  box-shadow:0 4px 12px rgba(0,0,0,0.15);
}
.logo-img:hover{transform:scale(1.1) rotate(5deg)}
h3{font-size:17px;font-weight:600;margin:0}
.subtitle{
  font-size:12px;color:#666;margin-top:3px;
}
body[data-theme="dark"] .subtitle{color:#999}
.theme-toggle{
  background:transparent;border:none;font-size:24px;cursor:pointer;padding:8px;
  border-radius:50%;transition:transform 0.3s,background 0.2s;
}
.theme-toggle:hover{transform:scale(1.15) rotate(15deg);background:rgba(0,0,0,0.05)}
body[data-theme="dark"] .theme-toggle:hover{background:rgba(255,255,255,0.08)}

.feed{
  display:grid;gap:16px;
  width:min(680px, 92vw);
  margin:20px auto;
}
.card{
  padding:18px;
  border-radius:20px;
  background:rgba(255,255,255,0.65);
  border:1px solid rgba(0,0,0,0.08);
  transition:transform 0.3s, box-shadow 0.3s;
  animation:fadeIn 0.5s ease-out;
}
body[data-theme="dark"] .card{
  background:rgba(30,30,30,0.65);
  border:1px solid rgba(255,255,255,0.1);
}
.card:hover{
  transform:translateY(-4px);
  box-shadow:0 12px 32px rgba(0,0,0,0.15);
}
body[data-theme="dark"] .card:hover{
  box-shadow:0 12px 32px rgba(0,0,0,0.5);
}
.card-meta{
  font-size:11px;color:#888;margin-bottom:10px;
}
.card-text{
  font-size:15px;line-height:1.5;white-space:pre-wrap;word-wrap:break-word;
}
.card-text a{color:#007aff;text-decoration:none;transition:color 0.2s}
.card-text a:hover{text-decoration:underline;color:#0051d5}
body[data-theme="dark"] .card-text a{color:#0a84ff}
.card-photo{
  max-width:400px;width:100%;height:auto;display:block;margin:12px auto 12px;
  border-radius:14px;
}
.no-news{text-align:center;color:#999;padding:40px 20px;font-size:15px}

.nav{
  position:fixed;bottom:12px;left:12px;right:12px;z-index:100;
  display:flex;justify-content:center;
  padding:10px;
  border-radius:22px;
}
.nav-inner{
  display:flex;gap:10px;justify-content:center;
}
.nav button{
  background:rgba(255,255,255,0.6);border:1px solid rgba(0,0,0,0.12);
  padding:11px 26px;border-radius:18px;cursor:pointer;font-size:14px;font-weight:500;
  transition:all 0.3s;color:#333;
}
body[data-theme="dark"] .nav button{
  background:rgba(50,50,50,0.6);border:1px solid rgba(255,255,255,0.18);color:#ccc;
}
.nav button:hover{
  background:rgba(255,255,255,0.9);transform:translateY(-2px) scale(1.05);
  box-shadow:0 6px 16px rgba(0,0,0,0.15);
}
body[data-theme="dark"] .nav button:hover{
  background:rgba(70,70,70,0.9);
}
.nav button[aria-current="true"]{
  background:#007aff;color:#fff;border-color:#007aff;
  box-shadow:0 4px 12px rgba(0,122,255,0.4);
}
body[data-theme="dark"] .nav button[aria-current="true"]{
  background:#0a84ff;border-color:#0a84ff;
  box-shadow:0 4px 12px rgba(10,132,255,0.4);
}

/* Liquid glass - —Ç–æ–ª—å–∫–æ CSS –¥–ª—è Telegram */
.liquid-glass{
  backdrop-filter:blur(20px) saturate(180%) brightness(1.1);
  -webkit-backdrop-filter:blur(20px) saturate(180%) brightness(1.1);
}
.header.liquid-glass{
  background:rgba(255,255,255,0.7);
  border:1px solid rgba(255,255,255,0.4);
  box-shadow:0 8px 32px rgba(0,0,0,0.12), inset 0 1px 2px rgba(255,255,255,0.5);
}
body[data-theme="dark"] .header.liquid-glass{
  background:rgba(20,20,20,0.7);
  border:1px solid rgba(255,255,255,0.2);
  box-shadow:0 8px 32px rgba(0,0,0,0.5), inset 0 1px 2px rgba(255,255,255,0.15);
}
.nav.liquid-glass{
  background:rgba(255,255,255,0.7);
  border:1px solid rgba(255,255,255,0.4);
  box-shadow:0 -4px 24px rgba(0,0,0,0.12);
}
body[data-theme="dark"] .nav.liquid-glass{
  background:rgba(20,20,20,0.7);
  border:1px solid rgba(255,255,255,0.2);
  box-shadow:0 -4px 24px rgba(0,0,0,0.4);
}

@keyframes fadeIn{
  from{opacity:0;transform:translateY(10px)}
  to{opacity:1;transform:translateY(0)}
}
</style>
</head>
<body>

<div class="header liquid-glass">
  <a href="https://t.me/ispanskie_msk">
    <img src="/logo.png" class="logo-img" alt="–õ–æ–≥–æ">
  </a>
  <div style="text-align:center;flex:1">
    <h3>–ê–≥—Ä–µ–≥–∞—Ç–æ—Ä –¥–ª—è —Ä–∞–π–æ–Ω–∞</h3>
    <div class="subtitle">by –ò—Å–ø–∞–Ω—Å–∫–∏–µ –ö–≤–∞—Ä—Ç–∞–ª—ã | –ü—Ä–æ–∫—à–∏–Ω–æ</div>
  </div>
  <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
    <span id="theme-icon">üåô</span>
  </button>
</div>

<div class="feed" id="feed"></div>

<div class="nav liquid-glass">
  <div class="nav-inner">
    <button onclick="filterNews('all')" aria-current="true" id="btn-all">–ù–æ–≤–æ—Å—Ç–∏</button>
    <button onclick="filterNews('business')" id="btn-business">–ë–∏–∑–Ω–µ—Å</button>
    <button onclick="filterNews('recommendations')" id="btn-recommendations">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</button>
  </div>
</div>

<script>
let allNews = [];
let currentFilter = 'all';

function toggleTheme() {
  const body = document.body;
  const icon = document.getElementById('theme-icon');
  const isDark = body.getAttribute('data-theme') === 'dark';
  body.setAttribute('data-theme', isDark ? '' : 'dark');
  icon.textContent = isDark ? 'üåô' : '‚òÄÔ∏è';
  localStorage.setItem('theme', isDark ? 'light' : 'dark');
}

function initTheme() {
  const saved = localStorage.getItem('theme');
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  const useDark = saved === 'dark' || (!saved && prefersDark);
  if (useDark) {
    document.body.setAttribute('data-theme', 'dark');
    document.getElementById('theme-icon').textContent = '‚òÄÔ∏è';
  }
}

function linkify(text) {
  const urlRegex = /(https?:\/\/[^\s]+)/g;
  return text.replace(urlRegex, '<a href="$1" target="_blank">$1</a>');
}

function formatDate(ts) {
  if (!ts) return '';
  const d = new Date(ts);
  const day = String(d.getDate()).padStart(2, '0');
  const month = String(d.getMonth() + 1).padStart(2, '0');
  const year = d.getFullYear();
  const hours = String(d.getHours()).padStart(2, '0');
  const minutes = String(d.getMinutes()).padStart(2, '0');
  const seconds = String(d.getSeconds()).padStart(2, '0');
  return `#${Math.floor(Math.random()*1000)} ¬∑ ${day}.${month}.${year}, ${hours}:${minutes}:${seconds} ¬∑ all`;
}

function renderNews() {
  const feed = document.getElementById('feed');
  const filtered = currentFilter === 'all' ? allNews : allNews.filter(n => n.category === currentFilter);
  if (!filtered.length) {
    feed.innerHTML = '<div class="no-news">–ù–µ—Ç –Ω–æ–≤–æ—Å—Ç–µ–π –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.</div>';
    return;
  }
  feed.innerHTML = filtered.map(n => {
    let html = '<div class="card">';
    html += `<div class="card-meta">${formatDate(n.timestamp)}</div>`;
    if (n.photoFileId) {
      html += `<img class="card-photo" src="/api/photo/${n.photoFileId}" alt="photo">`;
    }
    html += `<div class="card-text">${linkify(n.text || '')}</div>`;
    html += '</div>';
    return html;
  }).join('');
}

function filterNews(cat) {
  currentFilter = cat;
  document.querySelectorAll('.nav button').forEach(b => b.removeAttribute('aria-current'));
  const btnId = `btn-${cat}`;
  const btn = document.getElementById(btnId);
  if (btn) btn.setAttribute('aria-current', 'true');
  renderNews();
}

async function loadNews() {
  try {
    const res = await fetch('/api/news');
    const data = await res.json();
    allNews = Array.isArray(data.posts) ? data.posts : [];
    renderNews();
  } catch (e) {
    console.error(e);
  }
}

initTheme();
loadNews();
</script>
</body>
</html>
