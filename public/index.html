<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Агрегатор для района</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.0/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.0/dist/MarkerCluster.Default.css" />
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
      min-height:100vh;background:#f0f2f5;color:#1a1a1a;
      transition:background 0.3s ease, color 0.3s ease;
      padding-top:80px;padding-bottom:20px;
    }
    body[data-theme="dark"]{ background:#0e0e0e; color:#fff; }
    .header{
      position:fixed;top:12px;left:12px;right:12px;z-index:100;
      display:flex;justify-content:space-between;align-items:center;
      padding:14px 18px;border-radius:20px;
    }
    .logo-wrap{display:flex;align-items:center;gap:12px;text-decoration:none;color:inherit}
    .logo-img{
      width:40px;height:40px;border-radius:10px;transition:transform 0.3s;cursor:pointer;
      box-shadow:0 4px 12px rgba(0,0,0,0.15);
    }
    .logo-img:hover{transform:scale(1.1) rotate(5deg)}
    h3{font-size:17px;font-weight:600;margin:0}
    .subtitle{ font-size:12px;color:#666;margin-top:3px; }
    body[data-theme="dark"] .subtitle{color:#999}
    .theme-toggle{
      background:transparent;border:none;font-size:24px;cursor:pointer;padding:8px;
      border-radius:50%;transition:transform 0.3s,background 0.2s;
    }
    .theme-toggle:hover{transform:scale(1.15) rotate(15deg);background:rgba(0,0,0,0.05)}
    body[data-theme="dark"] .theme-toggle:hover{background:rgba(255,255,255,0.08)}
    .feed{
      display:grid;gap:16px;
      width:min(680px, 92vw);
      margin:20px auto 120px auto;
    }
    .card{
      padding:18px;border-radius:20px;overflow:hidden;
      background:rgba(255,255,255,0.65);
      border:1px solid rgba(0,0,0,0.08);
      transition:transform 0.3s, box-shadow 0.3s;
      animation:fadeIn 0.5s ease-out;
    }
    body[data-theme="dark"] .card{background:rgba(30,30,30,0.65);border:1px solid rgba(255,255,255,0.1);}
    .card:hover{transform:translateY(-4px);box-shadow:0 12px 32px rgba(0,0,0,0.15);}
    body[data-theme="dark"] .card:hover{box-shadow:0 12px 32px rgba(0,0,0,0.5);}
    .card-meta{font-size:11px;color:#888;margin-bottom:10px;line-height:1.4;}
    .card-meta a{color:inherit;text-decoration:underline;}
    .card-meta a:hover{opacity:0.85;}
    .card-text{font-size:15px;line-height:1.5;white-space:pre-wrap;word-wrap:break-word;}
    .card-text a{color:#007aff;text-decoration:none;transition:color 0.2s}
    .card-text a:hover{text-decoration:underline;color:#0051d5}
    body[data-theme="dark"] .card-text a{color:#0a84ff}
    .card-media{
      margin-top:12px;
      display:grid;
      gap:8px;
      grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));
    }
    .card-media img, .card-media video{
      width:100%;
      border-radius:12px;
      object-fit:cover;
      max-height:300px;
    }
    .card-media.single img, .card-media.single video{
      max-height:400px;
    }
    .no-news{text-align:center;color:#999;padding:40px 20px;font-size:15px}
    .liquid-glass{
      backdrop-filter:blur(20px) saturate(180%) brightness(1.1);
      -webkit-backdrop-filter:blur(20px) saturate(180%) brightness(1.1);
    }
    .header.liquid-glass{
      background:rgba(255,255,255,0.7);
      border:1px solid rgba(255,255,255,0.4);
      box-shadow:0 8px 32px rgba(0,0,0,0.12), inset 0 1px 2px rgba(255,255,255,0.5);
    }
    body[data-theme="dark"] .header.liquid-glass{
      background:rgba(20,20,20,0.7);
      border:1px solid rgba(255,255,255,0.2);
      box-shadow:0 8px 32px rgba(0,0,0,0.5), inset 0 1px 2px rgba(255,255,255,0.15);
    }
    #businessView{
      width:min(900px, 94vw);
      margin:18px auto 120px auto;
      display:none;
      gap:12px;
    }
    .biz-topbar{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }
    .biz-search{
      flex:1;min-width:200px;
    }
    .biz-search input{
      width:100%;
      padding:10px 14px;
      border-radius:14px;
      border:1px solid rgba(0,0,0,0.12);
      background:rgba(255,255,255,0.75);
      font-size:14px;
    }
    body[data-theme="dark"] .biz-search input{
      border:1px solid rgba(255,255,255,0.15);
      background:rgba(50,50,50,0.75);
      color:#fff;
    }
    .biz-filters{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
    }
    .chip{
      border:1px solid rgba(0,0,0,0.12);
      background:rgba(255,255,255,0.6);
      padding:8px 12px;
      border-radius:999px;
      cursor:pointer;
      font-size:13px;
      transition:transform .15s ease, background .2s ease;
    }
    body[data-theme="dark"] .chip{
      border:1px solid rgba(255,255,255,0.18);
      background:rgba(50,50,50,0.6);
      color:#ddd;
    }
    .chip.active{
      background:#007aff;
      border-color:#007aff;
      color:#fff;
    }
    body[data-theme="dark"] .chip.active{
      background:#0a84ff;
      border-color:#0a84ff;
    }
    .chip:hover{transform:scale(1.03)}
    .biz-actions{display:flex;gap:8px;align-items:center}
    .btn{
      border:1px solid rgba(0,0,0,0.12);
      background:rgba(255,255,255,0.75);
      padding:9px 12px;
      border-radius:14px;
      cursor:pointer;
      font-size:13px;
      transition:transform .15s ease, background .2s ease;
    }
    body[data-theme="dark"] .btn{
      border:1px solid rgba(255,255,255,0.18);
      background:rgba(50,50,50,0.75);
      color:#ddd;
    }
    .btn:hover{transform:translateY(-1px)}
    .biz-layout{display:grid;gap:12px;}
    #map{
      height: 50vh;
      min-height: 350px;
      max-height: calc(100vh - 280px);
      border-radius:20px;
      overflow:hidden;
      border:1px solid rgba(0,0,0,0.1);
      box-shadow:0 10px 28px rgba(0,0,0,0.12);
    }
    body[data-theme="dark"] #map{
      border:1px solid rgba(255,255,255,0.12);
      box-shadow:0 10px 28px rgba(0,0,0,0.45);
    }
    @media (max-height: 600px) {
      #map{
        height: 40vh;
        min-height: 280px;
        max-height: calc(100vh - 320px);
      }
    }
    .biz-form{
      display:none;
      padding:14px;
      border-radius:20px;
      background:rgba(255,255,255,0.65);
      border:1px solid rgba(0,0,0,0.08);
    }
    body[data-theme="dark"] .biz-form{
      background:rgba(30,30,30,0.65);
      border:1px solid rgba(255,255,255,0.1);
    }
    .biz-form .row{display:grid;gap:8px;margin:10px 0}
    .biz-form input, .biz-form select, .biz-form textarea{
      width:100%;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(0,0,0,0.12);
      background:rgba(255,255,255,0.9);
      font-size:14px;
    }
    body[data-theme="dark"] .biz-form input,
    body[data-theme="dark"] .biz-form select,
    body[data-theme="dark"] .biz-form textarea{
      border:1px solid rgba(255,255,255,0.15);
      background:rgba(20,20,20,0.8);
      color:#fff;
    }
    .biz-form textarea{min-height:80px;resize:vertical}
    .hint{font-size:12px;color:#777;line-height:1.4}
    body[data-theme="dark"] .hint{color:#aaa}
    .modal{
      display:none;
      position:fixed;
      top:0;left:0;right:0;bottom:0;
      background:rgba(0,0,0,0.5);
      z-index:1000;
      align-items:center;
      justify-content:center;
      padding:20px;
    }
    .modal.show{display:flex}
    .modal-content{
      background:rgba(255,255,255,0.95);
      border-radius:20px;
      max-width:600px;
      width:100%;
      max-height:85vh;
      overflow-y:auto;
      padding:20px;
      animation:slideUp 0.3s ease-out;
    }
    body[data-theme="dark"] .modal-content{
      background:rgba(30,30,30,0.95);
      border:1px solid rgba(255,255,255,0.1);
    }
    .modal-header{
      display:flex;justify-content:space-between;align-items:center;
      margin-bottom:16px;border-bottom:1px solid rgba(0,0,0,0.1);
      padding-bottom:12px;
    }
    body[data-theme="dark"] .modal-header{
      border-bottom:1px solid rgba(255,255,255,0.1);
    }
    .modal-close{
      background:none;border:none;font-size:24px;cursor:pointer;padding:0;
      color:inherit;transition:opacity 0.2s;
    }
    .modal-close:hover{opacity:0.6}
    .reviews-list{
      display:grid;gap:12px;margin:16px 0;
    }
    .review-item{
      padding:12px;
      border-radius:12px;
      background:rgba(0,0,0,0.03);
      border-left:3px solid #007aff;
    }
    body[data-theme="dark"] .review-item{
      background:rgba(255,255,255,0.05);
      border-left-color:#0a84ff;
    }
    .review-header{
      display:flex;justify-content:space-between;align-items:center;
      margin-bottom:6px;font-size:13px;
    }
    .review-author{font-weight:600}
    .review-rating{font-weight:600;color:#ffc107}
    .review-text{font-size:13px;line-height:1.4;margin:8px 0 0 0}
    .review-date{font-size:11px;color:#888;margin-top:8px}
    body[data-theme="dark"] .review-date{color:#aaa}
    .review-form{
      padding:12px;border-radius:12px;
      background:rgba(0,0,0,0.03);
      margin-top:16px;
    }
    body[data-theme="dark"] .review-form{
      background:rgba(255,255,255,0.05);
    }
    .review-form-row{margin:10px 0}
    .review-form-row label{
      display:block;font-size:13px;font-weight:600;margin-bottom:4px;
    }
    .review-form-row input, .review-form-row select, .review-form-row textarea{
      width:100%;
      padding:8px 10px;
      border-radius:10px;
      border:1px solid rgba(0,0,0,0.12);
      background:rgba(255,255
