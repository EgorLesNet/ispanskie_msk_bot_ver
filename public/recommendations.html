<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ - –ê–≥—Ä–µ–≥–∞—Ç–æ—Ä –¥–ª—è —Ä–∞–π–æ–Ω–∞</title>
<link rel="stylesheet" href="styles.css"/>
</head>
<body>
<header class="header liquid-glass">
<a class="logo-wrap" href="https://t.me/ispanskie_msk" target="_blank" rel="noopener">
<img class="logo-img" src="https://raw.githubusercontent.com/EgorLesNet/ispanskie_msk_bot_ver/main/public/logo.png" alt="–õ–æ–≥–æ"/>
<div><h3>–ê–≥—Ä–µ–≥–∞—Ç–æ—Ä –¥–ª—è —Ä–∞–π–æ–Ω–∞</h3><div class="subtitle">by –ò—Å–ø–∞–Ω—Å–∫–∏–µ –ö–≤–∞—Ä—Ç–∞–ª—ã | –ü—Ä–æ–∫—à–∏–Ω–æ</div></div>
</a>
<button class="theme-toggle" onclick="toggleTheme()" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É"><span id="theme-icon">üåô</span></button>
</header>
<main class="feed" id="feed"></main>
<nav class="nav liquid-glass">
<div class="nav-inner">
<a href="news.html" class="nav-btn"><span>üì∞</span><span class="nav-text"> –ù–æ–≤–æ—Å—Ç–∏</span></a>
<a href="business.html" class="nav-btn"><span>üíº</span><span class="nav-text"> –ë–∏–∑–Ω–µ—Å</span></a>
<a href="recommendations.html" class="nav-btn active"><span>‚≠ê</span><span class="nav-text"> –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</span></a>
</div>
</nav>
<script>
function toggleTheme(){const a=document.body,b=document.getElementById("theme-icon"),c="dark"===a.getAttribute("data-theme");a.setAttribute("data-theme",c?"":"dark"),b.textContent=c?"üåô":"‚òÄÔ∏è",localStorage.setItem("theme",c?"light":"dark")}function initTheme(){const a=localStorage.getItem("theme"),b=window.matchMedia("(prefers-color-scheme: dark)").matches;("dark"===a||!a&&b)&&(document.body.setAttribute("data-theme","dark"),document.getElementById("theme-icon").textContent="‚òÄÔ∏è")}function escapeHtml(a){return String(a||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function linkify(a){return escapeHtml(a).replace(/(https?:\/\/[^\s]+)/g,'<a href="$1" target="_blank" rel="noopener">$1</a>')}function formatDate(a){if(!a)return"";const b=new Date(a);return`${String(b.getDate()).padStart(2,"0")}.${String(b.getMonth()+1).padStart(2,"0")}.${b.getFullYear()}, ${String(b.getHours()).padStart(2,"0")}:${String(b.getMinutes()).padStart(2,"0")}`}function buildSourceLine(a){const b=a&&a.source?a.source:null;if(!b)return"";const c=b.postUrl||b.chatUrl||"",d=b.title||(b.username?"@"+b.username:"–ò—Å—Ç–æ—á–Ω–∏–∫");return c?` ¬∑ –ò—Å—Ç–æ—á–Ω–∏–∫: <a href="${escapeHtml(c)}" target="_blank" rel="noopener">${escapeHtml(d)}</a>`:` ¬∑ –ò—Å—Ç–æ—á–Ω–∏–∫: ${escapeHtml(d)}`}let allNews=[],hasBackgroundUpdates=!1;function renderNews(){const a=document.getElementById("feed"),b=allNews.filter(a=>"reco"===(a.category||"all"));if(!b.length)return void(a.innerHTML='<div class="no-news">–†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ!</div>');a.innerHTML=b.map(a=>{const b=a.timestamp||a.createdAt||null;let c='<div class="card">';c+=`<div class="card-meta">#${escapeHtml(a.id)} ¬∑ ${escapeHtml(formatDate(b))}${buildSourceLine(a)}</div>`;const d=(a.media||[]).filter(a=>a&&("photo"===a.type||"video"===a.type));return d.length>0&&(c+='<div class="card-media-scroll">',d.forEach(a=>{"photo"===a.type?c+=`<img src="/api/media/${encodeURIComponent(a.fileId)}" loading="lazy" alt="–§–æ—Ç–æ"/>`:"video"===a.type&&(c+=`<video controls preload="metadata" playsinline><source src="/api/media/${encodeURIComponent(a.fileId)}" type="video/mp4">–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.</video>`)}),c+="</div>"),c+=`<div class="card-text">${linkify(a.text||"")}</div></div>`,c}).join("")}function sameTop(a,b){const c=Array.isArray(a)&&a.length?a[0]:null,d=Array.isArray(b)&&b.length?b[0]:null;return c&&d&&c.id===d.id&&a.length===b.length}async function loadNews({render:a=!0}={}){try{const b=await fetch("/api/news",{cache:"no-store"}),c=await b.json(),d=Array.isArray(c.posts)?c.posts:[],e=!sameTop(allNews,d);allNews=d,a&&e&&renderNews(),!a&&e&&(hasBackgroundUpdates=!0)}catch(a){console.error(a)}}setInterval(()=>{"visible"!==document.visibilityState&&loadNews({render:!1})},3e3),document.addEventListener("visibilitychange",()=>{"visible"===document.visibilityState&&hasBackgroundUpdates&&(hasBackgroundUpdates=!1,renderNews())}),initTheme(),loadNews({render:!0});
</script>
</body>
</html>
